all:
  vars:
    DOMAIN: "{{ lookup('env', 'DOMAIN') }}"
    IP1: "{{ lookup('env', 'IP1') }}"
    IP2: "{{ lookup('env', 'IP2') }}"
    IP3: "{{ lookup('env', 'IP3') }}"
    ANSIBLE_USER: "{{ lookup('env', 'ANSIBLE_USER') }}"
    ENABLE_SPF: "{{ lookup('env', 'ENABLE_SPF') | default('false') | bool }}"
    ENABLE_DKIM: "{{ lookup('env', 'ENABLE_DKIM') | default('false') | bool }}"
    ENABLE_DMARC: "{{ lookup('env', 'ENABLE_DMARC') | default('false') | bool }}"

  children:
    mail:
      hosts:
        "{{ IP1 }}":
          ansible_user: "{{ ANSIBLE_USER }}"
          hostname: "mail.{{ DOMAIN }}"
          domain: "{{ DOMAIN }}"
          enable_dkim: "{{ ENABLE_DKIM }}"

    dns_master:
      hosts:
        "{{ IP2 }}":
          ansible_user: "{{ ANSIBLE_USER }}"
          hostname: "ns1.{{ DOMAIN }}"
          domain: "{{ DOMAIN }}"
          slave_ip: "{{ IP3 }}"
          mail_ip: "{{ IP1 }}"
          enable_spf: "{{ ENABLE_SPF }}"
          enable_dkim: "{{ ENABLE_DKIM }}"
          enable_dmarc: "{{ ENABLE_DMARC }}"

    dns_slave:
      hosts:
        "{{ IP3 }}":
          ansible_user: "{{ ANSIBLE_USER }}"
          hostname: "ns2.{{ DOMAIN }}"
          domain: "{{ DOMAIN }}"
          master_ip: "{{ IP2 }}"

